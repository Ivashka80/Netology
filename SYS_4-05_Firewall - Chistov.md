# Домашнее задание к занятию "Сеть и сетевые протоколы: Firewall"
 
<details>

Эти задания обязательные к выполнению. Пожалуйста, присылайте на проверку все задачи сразу. Любые вопросы по решению задач задавайте в чате учебной группы.

---

### Цели задания
1. Познакомиться с виртуальным окружением Virtual Box.
2. Научиться создавать виртуальные сетевые интерфейсы и их конфигурировать.
3. Реализовать проброс портов между двумя виртуальными машинами.

Данная практика закрепляет знания о создании виртуального окружения и его настройки. Эти навыки пригодятся для создания собственных сервисов и взаимодействия устройств по сети.

### Чеклист готовности к домашнему заданию
- Прочитайте статью [Инструкция по VirtualBox](https://hackware.ru/?p=3727). 
- Установите программу VirtualBox на своем компьютере.

### Инструкция по выполнению 
- Выполните оба задания.
- Сделайте скриншоты из VirtualBox по итогам выполнения каждого задания.
- Отправьте на проверку в личном кабинете Нетологии скриншоты. Файлы прикрепите в раздел "решение" в практическом задании.
- В комментариях к решению в личном кабинете Нетологии напишите пояснения к полученным результатам. 

---

## Задание 1. Создание виртуального окружения и настройка сетевых интерфейсов

### Описание задания
Перед вами стоит задача создать две виртуальные машины с операционной системой Debian и настроить управление трафиком.

### Требование к результату
Вы должны создать и настроить две виртуальные машины с операционной системой Debian. К выполненной задаче добавьте скриншоты настроек IP-адресов интерфейсов, таблиц маршрутизации, конфигурации файервола и результатов выполнения всех упомянутых проверок ping.

### Процесс выполнения
1. Запустите программу VirtualBox.
2. В программе VirtualBox создайте две виртуальные машины с Debian, назовите их vm1 и vm2
3. В VirtualBox создайте виртуальную сеть 192.168.123.0/24
4. В VirtualBox настройте сетевые интерфейсы vm1 так, чтобы один интерфейс имел доступ в интернет (bridge или NAT), а второй интерфейс смотрел в виртуальную сеть 192.168.123.0/24
5. В VirtualBox настройте сетевой интерфейс vm2 так, чтобы он смотрел только в виртуальную сеть 192.168.123.0
6. Для vm1: настройте статический IP адрес у интерфейса смотрящего в сеть 192.168.123.0 (адрес в сети 123.0 выберите на своё усмотрение). Настройте IP-адрес интерфейса смотрящего в вашу локальную сеть так, проверьте чтобы была доступность по ICMP c vm1 до 8.8.8.8.
7. Для vm2: настройте статический IP адрес у интерфейса смотрящего в сеть 192.168.123.0 (адрес в сети 123.0 выберите на своё усмотрение), шлюзом укажите IP vm1 из сети 192.168.123.0
8. Проверьте доступность по ICMP:
 - vm2 с vm1 по IP
 - vm1 с vm2 по IP 
9. Приложите скриншоты результата.
10. Настройте пересылку трафика на vm1, чтобы с vm2 можно было отправить ICMP-запросы на 8.8.8.8 и приложите скриншот результата.
11. Ответ внесите в комментарии к решению задания в личном кабинете Нетологии.

--- 

## Задание 2. Настройка проброса портов

### Описание задания
Перед вами стоит задача настроить проброс портов из локальной сети компьютера в виртуальную сеть.

### Требование к результату
К выполненной задаче добавьте скриншот настроек и успешное подключение через ssh.

### Процесс выполнения
1. Запустите программу VirtualBox.
2. В программе VirtualBox используйте результат предыдущей практической работы.
3. Настройте проброс портов из локальной сети компьютера с VirtualBox через vm1 порт 12322 в виртуальную сеть VirtualBox на 22 порт vm2.
4. Подключитесь к vm2 по ssh через Putty как было показано на уроке. Ответ внесите в комментарии к решению задания в личном кабинете Нетологии

---

### Общие критерии оценки
Задание считается выполненным при соблюдении следующих условий:
- Выполнено оба задания.
- К заданиям прикреплены скриншоты настроек виртуальных машин и их доступности после выполнения каждого задания.
- Отображены настройки конфигурации Firewal.
 
 </details>
 
# Ответ

## Задание 1

Для vm1 внешний ip через режим Bridge назначен 192.168.255.249/24. Вутренний ip – 192.168.123.4/24.

![Снимок01](https://user-images.githubusercontent.com/121082757/222700507-cdb3fd9c-825e-445d-90be-70f04d65acd5.PNG)

Для vm2 внутренний адрес 192.168.123.5/24.

![Снимок02](https://user-images.githubusercontent.com/121082757/222700557-62042b35-f231-4910-a3b3-d11e4310b83c.PNG)

Пингуем 8.8.8.8 с vm1.

![Снимок03](https://user-images.githubusercontent.com/121082757/222700641-7a78119f-66f5-46d3-963e-abb08d6b8339.PNG)

Пинг с vm2 на vm1.

![Снимок04](https://user-images.githubusercontent.com/121082757/222700671-e331ac84-dcba-46a2-b3c4-4189db8b71b7.PNG)

Пинг с vm1 на vm2.

![Снимок05](https://user-images.githubusercontent.com/121082757/222700714-d2bc0f9a-1e51-4d21-b20f-6e336c190241.PNG)

Нужно настроить пересылку трафика на vm1, чтобы с vm2 можно было отправить ICMP-запросы на 8.8.8.8. 

Для начала на vm1 проверим включена ли ip-пересылка - `cat /proc/sys/net/ipv4/ip_forward`.

В моем случае пересылка была выключена – значение 0.

![Снимок06](https://user-images.githubusercontent.com/121082757/222700769-30ba0616-a2d9-4765-96ce-c86c4f913fa1.PNG)

Включить пересылку можно двумя способами.


1. Команда `echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward`

2. Команда `sudo sysctl -w net.ipv4.ip_forward=1`

Далее нужно задать несколько правил.

На vm1.

`sudo iptables -A FORWARD -i enp0s8 -o enp0s3 -m state --state RELATED,ESTABLISHED -j ACCEPT` 

Данное правило задает, что если любой трафик, попавший на хост будет помечен ESTABLISHED и RELATED, он будет разрешен на пересылку.

`sudo iptables -A FORWARD -i enp0s8 -o enp0s3 -j ACCEPT`

Данной командой дается разрешение на пересылку новых соединений с интерфейса enp0s8 на enp0s3

`sudo iptables -t nat -A POSTROUTING -o enp0s3 -j MASQUERADE` 

Это правило маскирует с помощью NAT пакеты, которые идут через vm1 в глобальную сеть.

На vm2 задать маршрут через vm1.

`sudo ip route add default via 192.168.123.4`

Теперь с vm2 можно отправлять запрос на 8.8.8.8.

![Снимок07](https://user-images.githubusercontent.com/121082757/222702135-329b8edc-15b3-42c1-a061-40bad111bdbd.PNG)

## Задание 2

Сделать проброс портов из локальной сети компьютера через vm1 порт 12322 в виртуальную сеть VirtualBox на 22 порт vm2. Подключиться к vm2 по ssh через Putty как было показано на уроке.

Для переброса портов нужно выполнить пару действий

1. `sudo iptables -t nat -A PREROUTING -d 192.168.255.249 -p tcp --dport 44322 -j DNAT --to-destination 192.168.123.5:22`
 
2. `sudo iptables -I FORWARD 1 -i enp0s3 -o enp0s8 -d 192.168.123.5 -p tcp -m tcp --dport 22 -j ACCEPT`
 
Данными командами добавляется правило для водящей информации (PREROUTING ) от источника (локальная сеть компьютера), чтобы она через протокол tcp и порт 44322 прошла (FORWARD) уже на адрес внутренней сети vm2 и порт 22.

Вывод nat на vm1

![Снимок08](https://user-images.githubusercontent.com/121082757/222702362-da5cef68-e3dd-4a08-a3ec-dad9681b0af1.PNG)

Подключение к vm2 через vm1 с помощью PUTTY

![Снимок09](https://user-images.githubusercontent.com/121082757/222702397-1dcbe809-a438-4991-bc9b-294cc5b5b96b.PNG)

![Снимок10](https://user-images.githubusercontent.com/121082757/222702424-b0f6e3e2-2742-4b7a-bce9-0bb2b933b2c2.PNG)




